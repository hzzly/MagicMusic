# MagicMusic

>å‰è¨€ï¼šåœ¨æœ€è¿‘çš„ä¸€ä¸ªå¤–åŒ…é¡¹ç›®[ä¸­åŒ…è”ç›Ÿ](http://www.zblmchina.com/#/post)ä¸­ä½¿ç”¨åˆ°äº†videoï¼Œé‡åˆ°äº†å¥½å¤šå‘ã€‚çªå‘å¥‡æƒ³æ¥è¸©ä¸€è¸©audioçš„å‘ğŸ˜€ï¼Œæœç„¶ä¸€å…¥æ·±ä¼¼æµ·ï¼ŒğŸ‘‡ä¸‹é¢å°†åˆ†äº«æˆ‘çš„DIYä¹‹è·¯-VueéŸ³ä¹æ’­æ”¾å™¨ã€‚
>æ³¨ï¼šæœ¬é¡¹ç›®ä¸ºå¼€æºé¡¹ç›®ï¼Œä¸èƒ½ç”¨äºå•†ä¸šåº”ç”¨ï¼Œä»…ä¾›å­¦ä¹ ã€‚

[æ¸©é¦¨æç¤ºï¼špcæµè§ˆf12æ‰‹æœºæ¨¡å¼æœ€ä½³,æ‰‹æœºå»ºè®®wifiä¸‹è®¿é—®]
**demoåœ°å€ï¼š** [http://hjingren.cn/magic-music](http://hjingren.cn/magic-music)
æ¬¢è¿å¤§å®¶çš„starå•¦ğŸ˜„~

## Build Setup

``` bash
# install dependencies
npm install

# serve with hot reload at localhost:8080
npm run dev

# build for production with minification
npm run build

# build for production and view the bundle analyzer report
npm run build --report
```

API
``` bash
$ git clone git@github.com:Binaryify/NeteaseCloudMusicApi.git
$ npm install
$ node app.js
```

ğŸ‘‰è€é“ä»¬ï¼Œå‡†å¤‡å‘è½¦(æŠ€èƒ½ç‚¹)ï¼š
> * [vueæ–‡æ¡£](https://cn.vuejs.org/)
> * [vue-routeræ–‡æ¡£](https://router.vuejs.org/zh-cn/)
> * [vuexæ–‡æ¡£](https://vuex.vuejs.org/zh-cn/) ä¸æƒ³çœ‹æ–‡æ¡£çš„å¯ä»¥çœ‹çœ‹æˆ‘è¿™ç¯‡åšå®¢[vuexå­¦ä¹ å®è·µç¬”è®°](https://hzzly.github.io/2017/04/04/vuex%E5%AD%A6%E4%B9%A0%E5%AE%9E%E8%B7%B5%E7%AC%94%E8%AE%B0/)
> * [axiosæ–‡æ¡£](https://www.npmjs.com/package/axios) æˆ–è€…è¿™ç¯‡åšå®¢ [Vuex2 ä¸ Axios å¼€å‘](https://blog.ygxdxx.com/2017/02/01/Vuex2&Axios-Develop/)(æˆ‘ä¹Ÿæ˜¯å‚è€ƒè¿™ç¯‡ï¼Œæ„Ÿè°¢ä½œè€…ğŸ˜)
> * [es6(é˜®ä¸€å³°çš„es6å…¥é—¨)](http://es6.ruanyifeng.com/) å¯ä»¥å‚è€ƒ[æˆ‘çš„es6ä¹‹è·¯](https://hzzly.github.io/tags/es6/)(è¿˜åœ¨ç»§ç»­,è½»å–·)
> * [webpack2(ä¸­æ–‡ç½‘ç«™)](https://doc.webpack-china.org/)
> * [Promise (æµ…è°ˆPromise)](https://hzzly.github.io/2017/03/25/%E6%B5%85%E8%B0%88Promise/)
> * [flex (Webçš„flexå¼¹æ€§ç›’æ¨¡å‹)](https://hzzly.github.io/2017/03/03/Web%E7%9A%84Flex%E5%BC%B9%E6%80%A7%E7%9B%92%E6%A8%A1%E5%9E%8B/)
> * [ç§»åŠ¨ç«¯å±å¹•é€‚é…çš„è§£å†³ (flexible+rem)](https://hzzly.github.io/2017/03/15/%E7%A7%BB%E5%8A%A8%E7%AB%AF%E5%B1%8F%E5%B9%95%E9%80%82%E9%85%8D%E7%9A%84%E8%A7%A3%E5%86%B3/)
> * [æœ¬åœ°å­˜å‚¨(sessionStorageã€localStorage)](https://hzzly.github.io/2017/04/26/%E6%9C%AC%E5%9C%B0%E5%AD%98%E5%82%A8sessionStorage%E4%B8%8ElocalStorage/)
> * [å›¾ç‰‡æ‡’åŠ è½½](https://github.com/hilongjw/vue-lazyload?from=gold)

ğŸ‘‰åå¥½ï¼Œå‡ºå‘
### å®ç°çš„åŠŸèƒ½

#### 1ã€é¦–é¡µ
> - [x] è½®æ’­
> - [x] ä¸ªæ€§æ¨è[æµè¡Œã€å¤å…¸ã€è½»éŸ³ä¹ã€æµè¡Œ]
> - [x] æ­Œæ›²æ“ä½œ
>   - [x] åŠ å…¥æ’­æ”¾åˆ—è¡¨
>   - [ ] å–œæ¬¢
>   - [ ] åˆ†äº«

#### 2ã€åº•éƒ¨æ’­æ”¾æ§ä»¶
> - [x] æ’­æ”¾
> - [x] æš‚åœ
> - [x] ä¸‹ä¸€æ›²
> - [x] æ’­æ”¾è¿›åº¦æ¡

#### 3ã€æ’­æ”¾é¡µé¢
> - [x] ä¸Šä¸€æ›²
> - [x] æ’­æ”¾
> - [x] æš‚åœ
> - [x] ä¸‹ä¸€æ›²
> - [x] æ’­æ”¾è¿›åº¦æ¡[å¼§å½¢è¿›åº¦æ¡]
> - [x] æ­Œè¯æ»šåŠ¨
> - [x] æ’­æ”¾çš„æ­Œè¯é«˜äº®
> - [ ] æ’­æ”¾æ¨¡å¼[å•æ›²å¾ªç¯ã€åˆ—è¡¨å¾ªç¯ã€éšæœºæ’­æ”¾]

#### 4ã€æ’­æ”¾åˆ—è¡¨
> - [x] æ’­æ”¾æ­Œæ›²é«˜äº®
> - [x] åˆ‡æ­Œ(å•å‡»åˆ‡æ­Œ)
> - [x] åˆ æ­Œ(ç‚¹å‡»å³ä¾§å°X)
> - [ ] æ¸…ç©ºæ’­æ”¾åˆ—è¡¨
> - [ ] æœ¬åœ°ç¼“å­˜æ’­æ”¾åˆ—è¡¨

#### 5ã€æ’è¡Œæ¦œ
> - [x] çƒ­é—¨æ’è¡Œæ¦œ
> - [x] æ’è¡Œæ¦œé‡Œçš„æ­Œæ›²(å•å‡»æ’­æ”¾)

#### 6ã€éŸ³ä¹æœç´¢
è¾“å…¥æœç´¢å…³é”®è¯ï¼Œç‚¹å‡»`æ”¾å¤§é•œ`å›¾æ ‡
> - [x] å•æ›²(å•å‡»æˆ–ç‚¹å‡»æ­Œæ›²æ“ä½œ(...)æ·»åŠ è‡³éŸ³ä¹æ’­æ”¾åˆ—è¡¨ï¼Œéƒ¨åˆ†éŸ³ä¹ä¼šå­˜åœ¨ç‰ˆæƒé—®é¢˜æ— æ³•æ’­æ”¾)
> - [x] æ­Œæ‰‹
> - [x] ä¸“è¾‘
> - [x] æ­Œå•
> - [x] ç”¨æˆ·

#### ä¾§è¾¹æ 
> - [x] å¤´åƒ
> - [x] èœå•
>   - [x] ä¸ªäººä¸­å¿ƒ

### API
æ„Ÿè°¢ä½œè€…æŠŠapiæ•´ç†çš„è¿™ä¹ˆå¥½(ç‚¹ä¸ªèµğŸ‘)
>[ç½‘æ˜“äº‘éŸ³ä¹ NodeJS ç‰ˆ API](https://binaryify.github.io/NeteaseCloudMusicApi/#/?id=%e6%90%9c%e7%b4%a2%e9%9f%b3%e4%b9%90)

### å¼€å‘å¿ƒå¾—ä¸æ€»ç»“

#### 1ã€è½®æ’­å›¾
é¦–å…ˆæ„Ÿè°¢ä½œè€…[ShanaMaid/vue-image-scroll](https://github.com/ShanaMaid/vue-image-scroll)å¼€æºçš„ä»£ç ï¼Œæˆ‘æŠŠä»£ç copyä¸‹æ¥è‡ªå·±è¿›è¡Œäº†ä¸€ç‚¹ä¿®æ”¹(æ²¡æœ‰æ‰‹æŒ‡æ»‘åŠ¨æ•ˆæœ)ï¼Œå› ä¸ºè¿™æ˜¯ç§»åŠ¨ç«¯ï¼Œå°‘ä¸äº†çš„æ‰‹æŒ‡æ»‘åŠ¨åˆ‡æ¢ï¼Œæ‰€ä»¥æ·»åŠ äº†[vue-touch](https://github.com/vuejs/vue-touch#next)(å·å·å‘Šè¯‰ä½ ï¼Œvue-touchçš„nextåˆ†æ”¯è¿˜æ˜¯æ”¯æŒvue2.0çš„ğŸ˜œ)ã€‚[ä»£ç ä¼ é€é—¨](https://github.com/hzzly/MagicMusic/blob/master/src/components/banner.vue)
```javascript
<li v-for="(item,index) in image" :class="[move[index]]">
    <v-touch class="vuetouch"
            v-on:swipeleft="nextPic"
            v-on:swiperight="prePic">
        ...
    </v-touch>
</li>

methods: {
    nextPic(event) {
        let temp = this.move.pop()
        this.move.unshift(temp)
    },
    prePic(event) {
        let temp = this.move.shift()
        this.move.push(temp)
    },
}
```

#### 2ã€æ­Œæ›²æ“ä½œ(å–œæ¬¢ï¼Œåˆ†äº«ï¼ŒåŠ å…¥æ’­æ”¾åˆ—è¡¨)åŠ¨ç”»ã€æ’­æ”¾åˆ—è¡¨å±•å¼€ä¸åˆ é™¤æ­Œæ›²åŠ¨ç”»
> `Vue`æä¾›äº†`transition`çš„å°è£…ç»„ä»¶ï¼Œåœ¨ä¸‹åˆ—æƒ…å½¢ä¸­ï¼Œå¯ä»¥ç»™ä»»ä½•å…ƒç´ å’Œç»„ä»¶æ·»åŠ  entering/leaving è¿‡æ¸¡
>   * æ¡ä»¶æ¸²æŸ“ ï¼ˆä½¿ç”¨ v-ifï¼‰
>   * æ¡ä»¶å±•ç¤º ï¼ˆä½¿ç”¨ v-showï¼‰
>   * åŠ¨æ€ç»„ä»¶
>   * ç»„ä»¶æ ¹èŠ‚ç‚¹

```javascript
<transition name="move">
    <div class="menu" v-show="item.menuShow">
        ...
    </div>
</transition>

<transition-group name="slide" tag="div" class="list-wrapper">
    <div class="item" v-for="(item, index) in listenLists" :key="item">
        ...
    </div>
</transition-group>
```
> `transition-group`ä¸€ç»„è¿‡åº¦åŠ¨ç”»ï¼Œè¿™é‡Œæœ‰ä¸ªå°å‘çš„ï¼Œä¹‹å‰çœ‹å®˜ç½‘åˆ—è¡¨è¿‡æ¸¡çš„æ —å­ï¼Œç»™æ¯ä¸€é¡¹è®¾ç½®å”¯ä¸€çš„keyå€¼ï¼Œä¸€èˆ¬éƒ½ä¼šç”¨indexã€‚æ‰€ä»¥åœ¨åšçš„æ—¶å€™å°±æŠŠindexä¼ ç»™keyï¼Œç»“æœè¿‡æ¸¡è€æ˜¯ä¸å¯¹ï¼Œåæ¥æ¢æˆå¯¹åº”çš„`item`å°±æ­£å¸¸äº†(ç”Ÿæ— å¯æ‹è„¸)ã€‚

#### 3ã€ç›´çº¿è¿›åº¦æ¡ã€å¼§å½¢è¿›åº¦æ¡
> è¥¿ç­ç‰™å»ºç­‘å¤§å¸ˆæ›¾è¯´è¿‡ï¼šâ€œç›´çº¿å±äºäººç±»ï¼Œæ›²çº¿åˆ™å½’äºä¸Šå¸â€ã€‚åœ¨è¿™é‡Œæˆ‘å¤§èƒ†çš„ä½¿ç”¨äº†å¼§å½¢æ¥ä½œä¸ºè¿›åº¦æ¡ï¼Œ(å‡ å¤§çƒ­é—¨éŸ³ä¹APPè²Œä¼¼è¿˜æ²¡æœ‰å¼§å½¢è¿›åº¦æ¡ğŸ˜„)ã€‚

è¿™é‡Œæˆ‘ç”¨åˆ°äº†Vueçš„**ç»‘å®šå†…è”æ ·å¼**
```javascript
//é¦–é¡µåº•éƒ¨ç›´çº¿è¿›åº¦æ¡
<div class="progress-bar">
    <div class="play"
        :style="{width: (now / duration).toFixed(3)*100 + '%'}"></div>
</div>

//æ’­æ”¾é¡µå¼§å½¢è¿›åº¦æ¡
//å› ä¸ºç”¨åˆ°äº†å¼§å½¢ï¼Œæ‰€ä»¥æˆ‘è¿™é‡Œç”¨åˆ°äº†`border-radius`æ¥ä½¿å®ƒå˜æˆä¸€ä¸ªå¤§åœ†ï¼Œç„¶åå¹³ç§»`translateX`å±…ä¸­ï¼Œå…¶å®ƒä¸è¦çš„éƒ¨åˆ†`overflow: hidden`ã€‚
//è¿™é‡Œç”¨ä¸¤ä¸ªdivæ¥è¡¨ç¤ºè¿›åº¦æ¡ï¼Œä¸€æ¡å›ºå®šçš„è¿›åº¦æ¡ï¼Œä¸€æ¡æ…¢æ…¢å¢åŠ ã€‚
<div class="process" @click="showToast">
    <div class="line"></div>
    <div class="pro" :style="{transform: `translateX(${translateX}) rotate(${deg*1 + 56.5*((now / size).toFixed(3))}deg)`}"></div>
</div>
```

#### 4ã€æœ¬åœ°å­˜å‚¨
> å°†ä¸€äº›æ•°æ®ç¼“å­˜åˆ°localStorageï¼Œå¯ä»¥å‡å°‘Httpè¯·æ±‚ï¼Œä»è€Œä¼˜åŒ–é¡µé¢åŠ è½½æ—¶é—´ã€‚

åœ¨è¿™ä¸ªé¡¹ç›®ä¸­é¦–é¡µæ­Œæ›²åˆ—è¡¨ä»¥åŠæœç´¢å†å²ç”¨åˆ°äº†æœ¬åœ°ç¼“å­˜ï¼Œæ‹¿æœç´¢å†å²æ¥ä¸¾æ —ï¼š
```javascript
created() {
    if (!localStorage.searchHistory) {
        let searchHistory = ['å‰ç«¯', 'ç«¥è¯é•‡', 'åˆšå¥½é‡è§ä½ ']
        localStorage.searchHistory = JSON.stringify(searchHistory)
    } 
},
methods: {
    _search(keywords) {
        //åˆ¤æ–­æœç´¢åˆ—è¡¨ä¸­æ˜¯å¦å·²å­˜åœ¨
        let searchHistory = JSON.parse(localStorage.searchHistory)
        let find = searchHistory.findIndex((val) => {
            return val === keywords
        })
        find === -1 ? localStorage.searchHistory = JSON.stringify([keywords, ...searchHistory]) : ''
    }
}
```

#### 5ã€å›¾ç‰‡æ‡’åŠ è½½
ä½¿ç”¨äº†[vue-lazyload](https://github.com/hilongjw/vue-lazyload?from=gold)æ’ä»¶
ç”¨æ³•ğŸ‘‰ï¼š
```node
$ npm install vue-lazyload
```
```javascript
//main.js
import VueLazyLoad from 'vue-lazyload'
import def_lazy_img from '../static/img/loading.gif' //æ‡’åŠ è½½çš„é»˜è®¤å›¾ç‰‡
Vue.use(VueLazyLoad,{
    loading: def_lazy_img
}) //ä½¿ç”¨æ‡’åŠ è½½ç»„ä»¶

//åœ¨ä½¿ç”¨imgæ ‡ç­¾çš„åœ°æ–¹ä½¿ç”¨
<img v-lazy="item.al.picUrl" alt="">
```

#### 6ã€æ­Œè¯æ»šåŠ¨ä¸é«˜äº®
å› ä¸ºapiæä¾›çš„æ­Œè¯åŒ…æ‹¬æ—¶é—´ï¼Œå¦‚ï¼š`[03:57.280]åŸè°…æˆ‘è¿™ä¸€ç”Ÿä¸ç¾æ”¾çºµçˆ±è‡ªç”±`
æ‰€ä»¥é¦–å…ˆè¦è¿›è¡Œå­—ç¬¦ä¸²åˆ‡å‰²ï¼š
```javascript
<div class="lyric">
    <div class="roll-lyric" v-html="lyrics" ref="lyric"></div>
</div>

computed: {
    lyrics() {
        let lyrics = ''
        this.lyricArr = []
        if (this.lyric) {
            let arr = this.lyric.split('\n')
            for (let item of arr) {
                if (item) {
                    let arr2 = item.split(']')
                    this.lyricArr.push(arr2[0].substring(1,3)*60+arr2[0].substring(4)*1)
                    if (arr2) {
                        lyrics += `<p class='lyrichook' style='margin: 10px 0'>${arr2[1]}</p>`
                    }
                }
            }
        } else {
            lyrics = 'æš‚æ— æ­Œè¯~'
        }
        return lyrics
    }
}
```

ç„¶ååœ¨æ’­æ”¾çš„ç›‘å¬äº‹ä»¶ä¸­ä¸æ’­æ”¾çš„å½“å‰åšå¯¹æ¯”ï¼š
```javascript
this.$refs.myAudio.addEventListener('play', () => {
    this.pDOM = [...document.querySelectorAll('.lyrichook')]
    timer = setInterval(() => {
        this.now = audioDOM.currentTime
        this.lyricArr.forEach((item, index) => {
            if (parseInt(item) == parseInt(this.now)) {
                this.pDOM.forEach((p) => {
                    p.style.color = 'rgba(255,255,255,.8)' //å…¶å®ƒæ­Œè¯æ¸…é™¤é«˜äº®
                });
                this.pDOM[index].style.color = '#f12c61' //æ­Œè¯é«˜äº®
                this.$refs.lyric.style.transform = `translateY(-${(index-2)*25}px)` //æ­Œè¯æ»šåŠ¨
            } 
        });
    }, 1000)
})
```
åˆ°è¿™å°±okäº†ğŸ˜œ

#### 7ã€vuexçŠ¶æ€ç®¡ç†
æ¨èå®˜æ–¹è°ƒè¯•å·¥å…· [devtools extension](https://github.com/vuejs/vue-devtools)
> æƒ³è¿›ä¸€æ­¥ç†è§£vuexï¼Œå¯ä»¥çœ‹è¿™ç¯‡åšå®¢[vuexå­¦ä¹ å®è·µç¬”è®°](https://hzzly.github.io/2017/04/04/vuex%E5%AD%A6%E4%B9%A0%E5%AE%9E%E8%B7%B5%E7%AC%94%E8%AE%B0/)

ä¹‹å‰çœ‹åˆ°å¥½å¤šäººå†™çš„vuexï¼ŒæŠŠæ•´ä¸ªé¡¹ç›®çš„æ•°æ®æ”¾åˆ°äº†ä¸€ä¸ªstateé‡Œï¼Œå¯¼è‡´åº”ç”¨çš„æ‰€æœ‰çŠ¶æ€é›†ä¸­åˆ°ä¸€ä¸ªå¾ˆå¤§çš„å¯¹è±¡ã€‚ä½†æ˜¯ï¼Œå½“åº”ç”¨å˜å¾—å¾ˆå¤§æ—¶ï¼Œstore å¯¹è±¡ä¼šå˜å¾—è‡ƒè‚¿ä¸å ªã€‚
> æ‰€ä»¥æˆ‘å»ºè®®(ä¸ªäººè§è§£ï¼Œè½»å–·)ï¼šå°† store åˆ†å‰²åˆ°æ¨¡å—ï¼ˆmoduleï¼‰ã€‚æ¯ä¸ªæ¨¡å—æ‹¥æœ‰è‡ªå·±çš„ stateã€mutationã€actionã€gettersã€‚è¿™æ ·æ–¹ä¾¿ç®¡ç†ä¸åæœŸçš„ç»´æŠ¤ã€‚

è½¦å·²åˆ°ç«™âœŒï¸ã€‚

ä¸çŸ¥ä¸è§‰å†™äº†è¿™ä¹ˆå¤šï¼Œè€é“ä»¬å‡‘åˆè¿™çœ‹å§ğŸ˜ï¼Œè§‰å¾—è¿˜è¡Œçš„å¯ä»¥ç‚¹ä¸ªstarï¼Œ**ä½ çš„staræ˜¯æˆ‘ç»§ç»­å¼€æºåˆ›ä½œçš„åŠ¨åŠ›**ï¼Œè°¢è°¢ï¼ï¼ï¼
